# ğŸ“– Exemplos de Uso - Bot Discord Rematch

## ğŸ­ Auto-Role: SincronizaÃ§Ã£o de Cargos

### CenÃ¡rio 1: Jogador sobe de Ouro III para Platina I apÃ³s vitÃ³ria

**PHP (apÃ³s salvar resultado da partida):**
```php
$discordBot->syncUserRole($playerId, $oldMMR = 1299);
```

**Logs do Bot:**
```
[DISCORD] Sincronizando cargo para NinjaPlayer (Platina I)
ğŸ—‘ï¸ Removidos 2 cargos antigos de NinjaPlayer
   - Cargo removido: Ouro
   - Cargo removido: Fila Liberada (antigo)
âœ… Adicionados 2 novos cargos para NinjaPlayer
   + Cargo adicionado: Platina
   + Cargo adicionado: Fila Liberada
ğŸ‰ NinjaPlayer foi PROMOVIDO: Ouro III â†’ Platina I
```

**Resultado no Discord:**
- âŒ Cargo "Ouro" removido
- âœ… Cargo "Platina" adicionado
- Cor do nome muda para ciano (cor da Platina)

---

### CenÃ¡rio 2: Admin ajusta MMR manualmente

**PHP (painel admin):**
```php
// UsuÃ¡rio tinha 950 MMR (Prata II)
// Admin ajusta para 1100 MMR (Ouro I)

$oldMMR = 950;
$discordBot->syncUserRole($userId, $oldMMR);
```

**Logs do Bot:**
```
[DISCORD] Sincronizando cargo para ProPlayer (Ouro I)
ğŸ—‘ï¸ Removidos 1 cargo antigo de ProPlayer
   - Cargo removido: Prata
âœ… Adicionados 1 novo cargo para ProPlayer
   + Cargo adicionado: Ouro
ğŸ‰ ProPlayer foi PROMOVIDO: Prata II â†’ Ouro I
```

---

### CenÃ¡rio 3: Jogador nÃ£o tem discord_id vinculado

**PHP:**
```php
$discordBot->syncUserRole($userId);
```

**Logs do Bot:**
```
[DISCORD] UsuÃ¡rio PlayerSemDiscord nÃ£o possui discord_id vinculado
âŒ SincronizaÃ§Ã£o ignorada
```

**SoluÃ§Ã£o:** O jogador precisa vincular sua conta Discord no site (OAuth).

---

## ğŸ¨ Comando /perfil

### Exemplo 1: Visualizar prÃ³prio perfil

**Discord:**
```
/perfil
```

**Resultado:**
Bot gera e envia uma imagem PNG:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                             â”‚
â”‚  [ğŸ® Avatar]   PlayerName#1234              â”‚
â”‚                ğŸ’ DIAMANTE II               â”‚
â”‚                1,750 MMR                    â”‚
â”‚                                             â”‚
â”‚                [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 75%             â”‚
â”‚                75% para prÃ³xima divisÃ£o     â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ VITÃ“RIAS â”‚ DERROTAS â”‚ WINRATE â”‚ KDA â”‚   â”‚
â”‚  â”‚   145    â”‚    98    â”‚   59%   â”‚ 3.2 â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚         MAIN ROLE: Mid              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚         Generated by Rematch Inhouse Bot    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Cores:**
- Background: Gradiente azul brilhante (cor do Diamante)
- Borda do avatar: Azul brilhante com glow
- Nome do rank: Gradiente azul com sombra luminosa
- Barra de progresso: Azul preenchida

---

### Exemplo 2: Ver perfil de outro jogador

**Discord:**
```
/perfil @ProGamer
```

**Resultado:**
Mesma imagem, mas com dados do @ProGamer.

---

### Exemplo 3: Jogador nÃ£o registrado

**Discord:**
```
/perfil @NovoJogador
```

**Resposta do Bot:**
```
âŒ NovoJogador nÃ£o estÃ¡ registrado no sistema Inhouse.

Para se registrar, acesse o site e vincule sua conta do Discord.
```

---

## ğŸ”§ Deploy de Comandos

### Registrar comandos no servidor

**Terminal:**
```bash
cd bot/DsBot
node deploy-commands.js
```

**Output esperado:**
```
ğŸ“¦ Encontrados 1 arquivos de comando
  âœ… Carregado: perfil
ğŸš€ Iniciando deploy de 1 comandos...
ğŸ“ Deploy para servidor especÃ­fico (Guild ID: 123456789)
âœ… 1 comandos registrados com sucesso no servidor!

ğŸ“‹ Comandos registrados:
   /perfil - Exibe seu perfil premium de jogador com estatÃ­sticas
```

---

## ğŸ§ª Testes de IntegraÃ§Ã£o

### 1. Testar Health Check do Bot

**Terminal (ou navegador):**
```bash
curl http://localhost:3001/health
```

**Resposta esperada:**
```json
{
  "status": "ok",
  "bot": "RematchBot#1234",
  "integrations": {
    "ticketManager": true,
    "auditPoller": true,
    "reportPoller": false
  },
  "mode": "webhook"
}
```

---

### 2. Testar SincronizaÃ§Ã£o Manual (cURL)

**Terminal:**
```bash
curl -X POST http://localhost:3001/webhook/sync-role \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer SEU_WEBHOOK_SECRET" \
  -d '{
    "user_id": 1,
    "discord_id": "123456789012345678",
    "nickname": "TestPlayer",
    "mmr": 1500,
    "rank": {
      "tier": "PLATINA",
      "tier_name": "Platina",
      "division": 2,
      "division_numeral": "II",
      "full_name": "Platina II",
      "icon": "ğŸ’ "
    },
    "main_role": "MID",
    "position": "MID",
    "queue_permission": "ALLOWED"
  }'
```

**Resposta esperada:**
```json
{
  "success": true,
  "roles_removed": 2,
  "roles_added": 3,
  "current_rank": "Platina II"
}
```

---

### 3. Atualizar Cache de Cargos

Se vocÃª renomeou cargos no Discord:

**Terminal:**
```bash
curl -X POST http://localhost:3001/webhook/refresh-roles-cache \
  -H "Authorization: Bearer SEU_WEBHOOK_SECRET"
```

**Resposta:**
```json
{
  "success": true,
  "message": "Roles cache refreshed"
}
```

**Logs do Bot:**
```
ğŸ“¦ Cache de cargos atualizado: 7 tiers, 5 posiÃ§Ãµes, 3 permissÃµes
```

---

## ğŸ¯ Mapeamento Visual de Ranks

### Bronze (0-799 MMR)
- **Cor:** `#CD7F32` (bronze metÃ¡lico)
- **Ãcone:** ğŸ¥‰
- **Cargo Discord:** `Bronze`

### Prata (800-999 MMR)
- **Cor:** `#C0C0C0` (prata metÃ¡lico)
- **Ãcone:** ğŸ¥ˆ
- **Cargo Discord:** `Prata`

### Ouro (1000-1299 MMR)
- **Cor:** `#FFD700` (dourado brilhante)
- **Ãcone:** ğŸ¥‡
- **Cargo Discord:** `Ouro`

### Platina (1300-1599 MMR)
- **Cor:** `#00CED1` (ciano vibrante)
- **Ãcone:** ğŸ’ 
- **Cargo Discord:** `Platina`

### Diamante (1600-1899 MMR)
- **Cor:** `#B9F2FF` (azul claro brilhante)
- **Ãcone:** ğŸ’
- **Cargo Discord:** `Diamante`

### Mestre (1900-2199 MMR)
- **Cor:** `#9333EA` (roxo intenso)
- **Ãcone:** ğŸ‘‘
- **Cargo Discord:** `Mestre`

### Elite (2200+ MMR)
- **Cor:** `#EF4444` (vermelho ardente)
- **Ãcone:** ğŸ”¥
- **Cargo Discord:** `Elite`
- **DivisÃ£o:** Global (Ãºnica)

---

## ğŸ“Š Logs Esperados (Bot em ProduÃ§Ã£o)

### Logs Normais (Tudo OK)
```
[2025-12-16 15:30:45] INFO: âœ… Bot logado como RematchBot#1234
[2025-12-16 15:30:46] INFO: ğŸ“¦ Carregando 1 comandos slash...
[2025-12-16 15:30:46] INFO:   âœ… Comando carregado: /perfil
[2025-12-16 15:30:47] INFO: âœ… RoleSyncHandler inicializado
[2025-12-16 15:30:47] INFO: ğŸ“¦ Cache de cargos atualizado: 7 tiers, 5 posiÃ§Ãµes, 3 permissÃµes
[2025-12-16 15:30:48] INFO: âœ… Extended webhook server rodando na porta 3001

[2025-12-16 15:35:12] INFO: [DISCORD] Sincronizando cargo para Player123 (Ouro II)
[2025-12-16 15:35:13] INFO: ğŸ—‘ï¸ Removidos 2 cargos antigos de Player123
[2025-12-16 15:35:13] INFO: âœ… Adicionados 2 novos cargos para Player123

[2025-12-16 15:40:22] INFO: ğŸ“Š Comando /perfil executado por Admin#1234 para ver Player123
[2025-12-16 15:40:23] INFO: ğŸ¨ Gerando card para Player123 - Rank: Ouro II (1150 MMR)
[2025-12-16 15:40:24] INFO: âœ… Card enviado com sucesso para Player123
```

### Logs de AtenÃ§Ã£o (Avisos)
```
[2025-12-16 16:00:00] WARN: âš ï¸ Cargo de tier nÃ£o encontrado: Ouro
   â†’ SoluÃ§Ã£o: Criar cargo "Ouro" no Discord

[2025-12-16 16:05:30] WARN: âš ï¸ Membro nÃ£o encontrado no servidor: 123456789 (Player999)
   â†’ SoluÃ§Ã£o: Jogador nÃ£o estÃ¡ no servidor Discord

[2025-12-16 16:10:15] INFO: [DISCORD] UsuÃ¡rio NoDiscordPlayer nÃ£o possui discord_id vinculado
   â†’ SoluÃ§Ã£o: Jogador precisa vincular conta no site
```

---

## ğŸš¨ Troubleshooting RÃ¡pido

| Problema | SoluÃ§Ã£o |
|----------|---------|
| `/perfil` nÃ£o aparece | Execute `node deploy-commands.js` |
| Bot nÃ£o atualiza cargos | Verifique se o cargo do bot estÃ¡ ACIMA dos outros |
| "Unauthorized" nos webhooks | Verifique `WEBHOOK_SECRET` em `.env` |
| Avatar nÃ£o carrega | UsuÃ¡rio pode ter avatar privado |
| Database error | Verifique credenciais em `.env` (DB_*) |

---

## âœ… Checklist de Funcionamento

- [ ] Bot estÃ¡ online: `http://localhost:3001/health` retorna 200
- [ ] Comandos registrados: `/perfil` aparece no Discord
- [ ] Cargos criados: Bronze, Prata, Ouro, etc. existem no servidor
- [ ] PermissÃµes do bot: "Manage Roles" estÃ¡ ativada
- [ ] Hierarquia de cargos: Cargo do bot estÃ¡ acima dos ranks
- [ ] Banco de dados: Credenciais corretas em `.env`
- [ ] Webhook secret: Mesmo valor em PHP e Bot

**Tudo OK? VocÃª estÃ¡ pronto para usar!** ğŸ‰
